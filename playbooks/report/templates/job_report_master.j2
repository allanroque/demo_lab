<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* Base Font */
    body {
      font-family: "Overpass", "Red Hat Text", Arial, sans-serif;
      margin: 0;
      background-color: #f5f5f5;
      color: #333;
    }

    /* Navigation Bar */
    .sidenav {
      width: 250px;
      position: fixed;
      height: 100%;
      background-color: #000;
      padding-top: 20px;
    }

    .sidenav .logo {
      text-align: center;
      padding: 10px 0;
    }

    .sidenav .logo img {
      width: 150px;
      height: auto;
      border-radius: 5px;
    }

    .sidenav a {
      padding: 10px 15px;
      text-decoration: none;
      font-size: 14px;
      color: #fff;
      display: block;
    }

    .sidenav a:hover {
      background-color: #900;
      color: #fff;
    }

    .sidenav p {
      color: #ccc;
      padding-left: 15px;
      font-weight: bold;
      font-size: 16px;
    }

    /* Content Area */
    .content {
      margin-left: 260px;
      padding: 20px;
      background-color: #fff;
      border-left: 3px solid #900;
      min-height: 100vh;
    }

    h1, h2 {
      color: #900;
    }

    ul {
      list-style-type: none;
      padding: 0;
    }

    ul li {
      margin: 5px 0;
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    table th, table td {
      border: 1px solid #ddd;
      padding: 8px;
    }

    table th {
      background-color: #900;
      color: white;
      text-align: left;
    }

    table tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 10px;
      font-size: 12px;
      background-color: #111;
      color: #fff;
    }
  </style>
</head>

<body>

  <div class="sidenav">
    <div class="logo">
      <img src="https://github.com/nmartins0611/aap25-roadshow-content/blob/main/playbooks/section01/templates/ansible.png?raw=true" alt="Ansible">
    </div>
    <p><a style="text-align:center;font-weight:bold;font-size:medium" href="#summary">Summary</a></p>
    <hr>
    <p>Host Results</p>
    {% for item in ansible_play_hosts_all | sort %}
    <a {% if item in hostvars['localhost']['failed_list'] %}style="color: #ff6347;"{% elif item in hostvars['localhost']['missing_list'] %}style="color: #ffcc00;"{% endif %} href="#{{ item }}">{{ item }}</a>
    {% endfor %}
    
  </div>

  <div class="content">

    <h1 id="top">Infrastructure Report</h1>
    <p><i>Job started {{ hostvars['localhost']['date_str_pretty'] }}</i></p>
    <hr>

    <h1 id="summary">Summary</h1>

    <p><strong>Host Totals:</strong></p>
      <ul>
        <li>Successful: {{ hostvars['localhost']['success_list']|length }}</li>
        <li>Failed: {{ hostvars['localhost']['failed_list']|length }}</li>
        <li>Missing: {{ hostvars['localhost']['missing_list']|length }}</li>
        <li>Total: {{ hostvars['localhost']['success_list']|length + hostvars['localhost']['failed_list']|length + hostvars['localhost']['missing_list']|length }}</li>
      </ul>

    <p><strong>Kernel Versions across Environment:</strong></p>
    <table>
      {% for item in hostvars['localhost']['kernels_list'] %}
      <tr><th>Kernel {{ item }}</th></tr>
      <tr><td>{{ hostvars | dict2items | json_query('[?value.ansible_kernel==`' + item + '`].key') | join(' ') | default('NO KERNELS FOUND') }}</td></tr>
      {% endfor %}
    </table>

    {% for thehost in ansible_play_hosts_all | sort %}
      {% include './job_report_host.j2' %}
    {% endfor %}
    
    <hr>
    <footer>
      <p>Generated by <strong>Ansible</strong></p>
    </footer>
  
  </div>

</body>
</html>
